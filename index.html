<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìã Registro Integral</title>

<style>
:root{
  --bg:#f4f6fb;
  --card:#ffffff;
  --txt:#222;
  --pri:#2563eb;
  --sec:#22c55e;
  --rad:16px;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f172a;
    --card:#1e293b;
    --txt:#e5e7eb;
  }
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--txt)}
header{
  padding:14px;
  font-size:20px;
  font-weight:700;
  text-align:center;
}
main{padding:16px;display:grid;gap:16px;padding-bottom:90px}
.card{
  background:var(--card);
  border-radius:var(--rad);
  padding:16px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
  transition:.2s;
}
.card:hover{transform:translateY(-2px)}
button{
  border:none;
  border-radius:12px;
  padding:10px 14px;
  background:var(--pri);
  color:#fff;
  font-weight:600;
}
button.alt{background:var(--sec)}
button.ghost{background:#64748b}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #94a3b8;
  margin-bottom:8px;
  background:transparent;
  color:inherit;
}
.field{display:flex;gap:8px;align-items:center;margin-bottom:8px}
.icon{font-size:20px}
.nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  justify-content:space-around;
  background:var(--card);
  padding:10px;
  box-shadow:0 -4px 10px rgba(0,0,0,.1);
}
.nav button{background:none;color:var(--txt);font-size:18px}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal.active{display:flex}
.modal .card{
  width:95%;
  max-width:520px;
  max-height:90vh;
  overflow:auto;
}
.preview{width:100%;border-radius:12px;margin-top:8px}

/* SPLASH */
#splash{
  position:fixed;
  inset:0;
  background:linear-gradient(135deg,#2563eb,#1e3a8a);
  display:flex;
  justify-content:center;
  align-items:center;
  z-index:9999;
  animation:fadeOut 1s ease forwards;
  animation-delay:2.5s;
}
.splash-card{text-align:center;color:#fff;animation:pop 1s ease}
.splash-icon{font-size:64px;margin-bottom:12px}
@keyframes pop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes fadeOut{to{opacity:0;visibility:hidden}}
</style>
</head>

<body>

<!-- SPLASH -->
<div id="splash">
  <div class="splash-card">
    <div class="splash-icon">üìã</div>
    <h1>Registro Integral</h1>
    <p>Gesti√≥n de Salud Digital</p>
  </div>
</div>

<header>‚öôÔ∏è üìã Registro Integral de Salud</header>
<main id="windows"></main>

<!-- NAV -->
<div class="nav">
  <button onclick="openConfig()">‚öôÔ∏è</button>
  <button onclick="alert('Registro Integral v1.0')">‚ÑπÔ∏è</button>
</div>

<!-- CONFIG -->
<div class="modal" id="config">
<div class="card">
<h3>‚öôÔ∏è Configuraci√≥n</h3>

<input id="wsap" placeholder="N√∫mero WhatsApp (57XXXXXXXXXX)">
<button onclick="save()">Guardar WhatsApp</button>

<hr>
<h4>‚ûï Crear ventana</h4>
<input id="wName" placeholder="Nombre ventana">
<input id="wIcon" placeholder="Emoji / √≠cono">
<button onclick="addWindow()">Agregar</button>

<h4>üóëÔ∏è Eliminar ventana</h4>
<select id="delWin"></select>
<button onclick="delWindow()">Eliminar</button>

<hr>
<h4>‚ûï Crear campo</h4>
<select id="wSel"></select>
<input id="fIcon" placeholder="Emoji">
<input id="fName" placeholder="Nombre campo">
<select id="fType">
  <option value="text">Texto</option>
  <option value="number">Num√©rico</option>
  <option value="auto">Autom√°tico</option>
  <option value="select">Desplegable</option>
  <option value="cam">C√°mara</option>
</select>
<input id="fOpt" placeholder="Opciones (A|B|C)">
<button onclick="addField()">Agregar campo</button>

<hr>
<h4>‚≠ê Plantillas</h4>
<select id="tplWin"></select>
<input id="tplName" placeholder="Nombre plantilla">
<button onclick="saveTemplate()">Guardar plantilla</button>

<select id="tplSel"></select>
<button onclick="applyTemplate()">Aplicar plantilla</button>

<hr>
<button class="ghost" onclick="closeConfig()">Cerrar</button>
</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("appData")) || {
  wsap:"",
  windows:[],
  templates:[]
};

function save(){
  data.wsap = wsap.value;
  localStorage.setItem("appData", JSON.stringify(data));
  render();
}

function openConfig(){
  wsap.value = data.wsap;
  loadSelects();
  config.classList.add("active");
}
function closeConfig(){config.classList.remove("active")}

function addWindow(){
  if(!wName.value) return;
  data.windows.push({name:wName.value,icon:wIcon.value||"üìã",fields:[]});
  wName.value=wIcon.value="";
  save();
}

function delWindow(){
  data.windows.splice(delWin.value,1);
  save();
}

function addField(){
  let w = data.windows[wSel.value];
  w.fields.push({
    icon:fIcon.value||"üè∑Ô∏è",
    name:fName.value,
    type:fType.value,
    opt:fOpt.value||"",
    val:""
  });
  fIcon.value=fName.value=fOpt.value="";
  save();
}

function saveTemplate(){
  let w=data.windows[tplWin.value];
  data.templates.push({
    name:tplName.value,
    fields:JSON.parse(JSON.stringify(w.fields))
  });
  tplName.value="";
  save();
}

function applyTemplate(){
  let t=data.templates[tplSel.value];
  let w=data.windows[wSel.value];
  t.fields.forEach(f=>w.fields.push(JSON.parse(JSON.stringify(f))));
  save();
}

function loadSelects(){
  delWin.innerHTML=wSel.innerHTML=tplWin.innerHTML=
    data.windows.map((w,i)=>`<option value="${i}">${w.icon} ${w.name}</option>`).join("");
  tplSel.innerHTML=data.templates.map((t,i)=>`<option value="${i}">‚≠ê ${t.name}</option>`).join("");
}

function render(){
  windows.innerHTML="";
  data.windows.forEach((w,wi)=>{
    let html=`<div class="card"><h3>${w.icon} ${w.name}</h3>`;
    w.fields.forEach((f,fi)=>{
      if(f.type==="cam"){
        html+=`
        <div class="field">
          <span class="icon">${f.icon}</span>
          <input type="file" accept="image/*" capture="environment"
          onchange="preview(event,${wi},${fi})">
        </div>
        <img id="p${wi}${fi}" class="preview">
        `;
      }else if(f.type==="select"){
        html+=`
        <div class="field">
          <span class="icon">${f.icon}</span>
          <select onchange="data.windows[${wi}].fields[${fi}].val=this.value;save()">
            ${f.opt.split("|").map(o=>`<option>${o}</option>`).join("")}
          </select>
        </div>`;
      }else{
        let t=f.type==="number"?"number":"text";
        let v=f.type==="auto"?new Date().toLocaleString():f.val;
        html+=`
        <div class="field">
          <span class="icon">${f.icon}</span>
          <input type="${t}" value="${v}"
          oninput="data.windows[${wi}].fields[${fi}].val=this.value;save()">
        </div>`;
      }
    });
    html+=`<button class="alt" onclick="send(${wi})">üì§ Enviar WhatsApp</button></div>`;
    windows.innerHTML+=html;
  });
}

function preview(e,wi,fi){
  let r=new FileReader();
  r.onload=()=>document.getElementById(`p${wi}${fi}`).src=r.result;
  r.readAsDataURL(e.target.files[0]);
}

function send(i){
  let w=data.windows[i];
  let msg=`${w.icon} ${w.name}%0A`;
  w.fields.forEach(f=>{
    msg+=`${f.icon} ${f.name}: ${f.val||""}%0A`;
  });
  window.open(`https://wa.me/${data.wsap}?text=${msg}`);
}

render();
</script>
</body>
 </html>
