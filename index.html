<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoveClinic FINAL</title>

<style>
body{
 font-family:Arial,Helvetica,sans-serif;
 margin:0;
 background:#f4f6f8;
}
header{
 background:#0b5ed7;
 color:#fff;
 padding:12px;
 text-align:center;
 font-size:18px;
}
nav{
 display:flex;
 gap:6px;
 padding:8px;
 background:#e9ecef;
 flex-wrap:wrap;
 justify-content:center;
}
nav button{
 padding:8px 12px;
 border:none;
 border-radius:6px;
 background:#0b5ed7;
 color:white;
 cursor:pointer;
}
nav button.secondary{
 background:#6c757d;
}
section{
 display:none;
 padding:10px;
}
section.active{
 display:block;
}
.field{
 margin-bottom:10px;
}
.field label{
 font-weight:bold;
 display:block;
 margin-bottom:4px;
}
.field input, .field select, .field textarea{
 width:100%;
 padding:8px;
 border-radius:6px;
 border:1px solid #ccc;
 font-size:16px;
}
textarea{ resize:vertical }
.small{
 font-size:12px;
 color:#555;
}
.actions{
 display:flex;
 gap:8px;
 flex-wrap:wrap;
}
.actions button{
 flex:1;
 padding:10px;
 border:none;
 border-radius:6px;
 font-size:15px;
 cursor:pointer;
}
.send{ background:#25d366;color:#fff }
.save{ background:#0b5ed7;color:#fff }
.clear{ background:#dc3545;color:#fff }
.card{
 background:#fff;
 border-radius:8px;
 padding:10px;
 margin-bottom:10px;
 box-shadow:0 1px 4px rgba(0,0,0,.1);
}
.hidden{display:none}
</style>
</head>

<body>

<header>NoveClinic â€“ Registro Inteligente</header>

<nav>
<button onclick="openWin('novedad')">ğŸ“ Novedad</button>
<button onclick="openWin('ingreso')">â¬…ï¸ Ingreso</button>
<button onclick="openWin('salida')">â¡ï¸ Salida</button>
<button onclick="openWin('plantillas')">ğŸ“‚ Plantillas</button>
<button class="secondary" onclick="openWin('config')">âš™ï¸ ConfiguraciÃ³n</button>
</nav>

<!-- ================= NOVEDAD ================= -->
<section id="novedad" class="active">
<div class="card">
<h3>Registro de Novedad</h3>

<div class="field">
<label>ğŸ“… Fecha y hora</label>
<input id="nov_fecha" readonly>
</div>

<div class="field">
<label>ğŸ“ Lugar</label>
<input list="lugares" id="nov_lugar">
<datalist id="lugares"></datalist>
</div>

<div class="field">
<label>ğŸ‘¤ Nombre</label>
<input id="nov_nombre">
</div>

<div class="field">
<label>ğŸ†” Tipo documento</label>
<select id="nov_tipo">
<option>CC</option>
<option>TI</option>
<option>RC</option>
<option>PPT</option>
</select>
</div>

<div class="field">
<label>ğŸ†” NÃºmero</label>
<input id="nov_doc" inputmode="numeric">
</div>

<div class="field">
<label>ğŸ“‹ Novedad</label>
<textarea id="nov_texto"></textarea>
</div>

<div id="custom_novedad"></div>

<div class="actions">
<button class="send" onclick="previewWhatsApp('novedad')">ğŸ“¤ WhatsApp</button>
<button class="save" onclick="saveTemplate()">â­ Guardar plantilla</button>
<button class="clear" onclick="clearForm('novedad')">ğŸ§¹ Limpiar</button>
</div>
</div>
</section>

<!-- ================= INGRESO ================= -->
<section id="ingreso">
<div class="card">
<h3>Ingreso</h3>
<div id="custom_ingreso"></div>
<button class="send" onclick="previewWhatsApp('ingreso')">ğŸ“¤ WhatsApp</button>
</div>
</section>

<!-- ================= SALIDA ================= -->
<section id="salida">
<div class="card">
<h3>Salida</h3>
<div id="custom_salida"></div>
<button class="send" onclick="previewWhatsApp('salida')">ğŸ“¤ WhatsApp</button>
</div>
</section>

<!-- ================= PLANTILLAS ================= -->
<section id="plantillas">
<div class="card">
<h3>Plantillas guardadas</h3>
<div id="tpl_list"></div>
</div>
</section>

<!-- ================= CONFIG ================= -->
<section id="config">
<div class="card">
<h3>ConfiguraciÃ³n</h3>

<h4>â• Etiquetas personalizadas</h4>
<div class="field"><input id="lbl_name" placeholder="Etiqueta (ej: ğŸš‘ Trasladado por)"></div>
<div class="field">
<select id="lbl_type">
<option value="text">Texto</option>
<option value="number">NumÃ©rico</option>
<option value="select">Desplegable</option>
</select>
</div>
<div class="field"><input id="lbl_values" placeholder="Valores separados por coma"></div>
<div class="field">
<label><input type="checkbox" id="lbl_nov" checked> Novedad</label>
<label><input type="checkbox" id="lbl_ing"> Ingreso</label>
<label><input type="checkbox" id="lbl_sal"> Salida</label>
</div>
<button class="save" onclick="addLabel()">Guardar etiqueta</button>

<hr>

<h4>ğŸ§  Aprendizaje</h4>
<button onclick="resetLearning()">Borrar aprendizaje</button>

</div>
</section>

<!-- ================= RESUMEN ================= -->
<div id="preview" class="card hidden">
<h3>Resumen WhatsApp</h3>
<textarea id="preview_text" style="height:200px"></textarea>
<div class="actions">
<button class="send" onclick="sendWA()">Enviar</button>
<button onclick="closePreview()">Cancelar</button>
</div>
</div>

<script>
/* ====== UTIL ====== */
function openWin(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 if(id==="plantillas") loadTemplates();
}

/* ====== FECHA ====== */
function now(){
 return new Date().toLocaleString("es-CO");
}
document.getElementById("nov_fecha").value=now();

/* ====== STORAGE ====== */
function get(k){return JSON.parse(localStorage.getItem(k)||"{}")}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

/* ====== ETIQUETAS ====== */
function addLabel(){
 const labels=get("labels");
 const id="lbl_"+Date.now();
 labels[id]={
  name:lbl_name.value,
  type:lbl_type.value,
  values:lbl_values.value.split(",").map(v=>v.trim()).filter(v=>v),
  windows:{
   nov:lbl_nov.checked,
   ing:lbl_ing.checked,
   sal:lbl_sal.checked
  }
 };
 set("labels",labels);
 lbl_name.value="";lbl_values.value="";
 renderLabels();
 alert("Etiqueta guardada");
}

function renderLabels(){
 ["novedad","ingreso","salida"].forEach(w=>{
  const cont=document.getElementById("custom_"+w);
  if(!cont) return;
  cont.innerHTML="";
  const labels=get("labels");
  Object.values(labels).forEach(l=>{
   if((w==="novedad"&&l.windows.nov)||(w==="ingreso"&&l.windows.ing)||(w==="salida"&&l.windows.sal)){
    const div=document.createElement("div");
    div.className="field";
    div.innerHTML="<label>"+l.name+"</label>";
    if(l.type==="select"){
     const sel=document.createElement("select");
     l.values.forEach(v=>{
      const o=document.createElement("option");o.text=v;sel.add(o);
     });
     div.appendChild(sel);
    }else{
     const inp=document.createElement("input");
     if(l.type==="number") inp.inputMode="numeric";
     div.appendChild(inp);
    }
    cont.appendChild(div);
   }
  });
 });
}
renderLabels();

/* ====== WHATSAPP ====== */
let currentText="";
function previewWhatsApp(win){
 let txt="";
 if(win==="novedad"){
  if(nov_fecha.value) txt+="ğŸ“… "+nov_fecha.value+"\n";
  if(nov_lugar.value) txt+="ğŸ“ "+nov_lugar.value+"\n";
  if(nov_nombre.value) txt+="ğŸ‘¤ "+nov_nombre.value+"\n";
  if(nov_doc.value) txt+="ğŸ†” "+nov_tipo.value+" "+nov_doc.value+"\n";
  if(nov_texto.value) txt+="ğŸ“‹ "+nov_texto.value+"\n";
 }
 document.getElementById("preview_text").value=txt;
 currentText=txt;
 document.getElementById("preview").classList.remove("hidden");
}

function sendWA(){
 const t=encodeURIComponent(preview_text.value);
 window.open("https://wa.me/?text="+t,"_blank");
 closePreview();
}

function closePreview(){
 document.getElementById("preview").classList.add("hidden");
}

/* ====== PLANTILLAS ====== */
function saveTemplate(){
 const tpls=get("templates");
 tpls[Date.now()]={text:preview_text.value};
 set("templates",tpls);
 alert("Plantilla guardada");
}
function loadTemplates(){
 const list=document.getElementById("tpl_list");
 list.innerHTML="";
 const tpls=get("templates");
 Object.entries(tpls).forEach(([id,t])=>{
  const b=document.createElement("button");
  b.textContent="Reutilizar";
  b.onclick=()=>{preview_text.value=t.text;openWin("novedad")};
  list.appendChild(b);
 });
}

/* ====== LIMPIAR ====== */
function clearForm(win){
 if(win==="novedad"){
  ["nov_lugar","nov_nombre","nov_doc","nov_texto"].forEach(id=>document.getElementById(id).value="");
 }
}
</script>

</body>
</html>
