<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NoveClinic FINAL V7</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f6f8}
header{background:#0b5ed7;color:#fff;padding:12px;text-align:center;font-size:18px}
nav{display:flex;gap:6px;padding:8px;background:#e9ecef;flex-wrap:wrap;justify-content:center}
nav button{padding:8px 12px;border:none;border-radius:6px;background:#0b5ed7;color:white;cursor:pointer}
nav button.secondary{background:#6c757d}
section{display:none;padding:10px}
section.active{display:block}
.field{margin-bottom:10px}
.field label{font-weight:bold;display:block;margin-bottom:4px}
.field input,.field select,.field textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;font-size:16px}
textarea{resize:vertical}
.actions{display:flex;gap:8px;flex-wrap:wrap}
.actions button{flex:1;padding:10px;border:none;border-radius:6px;font-size:15px;cursor:pointer}
.send{background:#25d366;color:#fff}
.save{background:#0b5ed7;color:#fff}
.clear{background:#dc3545;color:#fff}
.card{background:#fff;border-radius:8px;padding:10px;margin-bottom:10px;box-shadow:0 1px 4px rgba(0,0,0,.1)}
.hidden{display:none}
#previewModal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;z-index:9999;width:90%;max-width:500px;padding:15px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.3);}
#previewModal textarea{height:180px;width:100%;margin-bottom:10px;}
</style>
</head>

<body>

<header>NoveClinic â€“ Registro Inteligente</header>

<nav id="mainNav">
<button onclick="openWin('base')">ğŸ§© Ventana Base</button>
<button class="secondary" onclick="openWin('config')">âš™ï¸ ConfiguraciÃ³n</button>
</nav>

<!-- ================= VENTANA BASE ================= -->
<section id="base" class="active">
<div class="card">
<h3>Ventana Base</h3>

<div class="field">
<label>ğŸ“… Fecha y hora</label>
<input id="base_fecha" readonly>
</div>

<!-- CAMPOS FIJOS -->
<div class="field">
<label>ğŸ‘¤ Nombre</label>
<input id="base_nombre">
</div>

<div class="field">
<label>ğŸ†” Documento</label>
<input id="base_doc" inputmode="numeric">
</div>

<!-- ETIQUETAS DINÃMICAS -->
<div id="custom_base"></div>

<div class="actions">
<button class="send" onclick="previewWhatsApp('base')">ğŸ“¤ WhatsApp</button>
<button class="clear" onclick="clearForm('base')">ğŸ§¹ Limpiar</button>
</div>
</div>
</section>

<!-- ================= CONFIG ================= -->
<section id="config">
<div class="card">
<h3>ConfiguraciÃ³n</h3>

<h4>â• Crear nueva ventana (clonar)</h4>
<div class="field">
<input id="new_win_name" placeholder="Nombre de la ventana">
</div>
<button class="save" onclick="cloneWindow()">â• Crear ventana</button>

<hr>

<h4>â• Etiquetas personalizadas</h4>
<div class="field"><input id="lbl_name" placeholder="Nombre etiqueta"></div>
<div class="field">
<select id="lbl_type">
<option value="text">Texto</option>
<option value="number">NumÃ©rico</option>
<option value="select">Desplegable</option>
</select>
</div>
<div class="field"><input id="lbl_values" placeholder="Valores separados por coma"></div>
<div class="field">
<label><input type="checkbox" id="lbl_base" checked> Ventana Base</label>
</div>
<button class="save" onclick="addLabel()">Guardar etiqueta</button>

<hr>
<h4>ğŸ› ï¸ Administrar etiquetas</h4>
<div id="label_manager"></div>

</div>
</section>

<!-- ================= PREVIEW ================= -->
<div id="previewModal" class="hidden">
<h3>Resumen WhatsApp</h3>
<textarea id="preview_text"></textarea>
<div class="actions">
<button class="send" onclick="sendWA()">Enviar</button>
<button onclick="closePreview()">Cancelar</button>
</div>
</div>

<script>
/* ===== UTIL ===== */
function now(){return new Date().toLocaleString("es-CO")}
function get(k){return JSON.parse(localStorage.getItem(k)||"{}")}
function set(k,v){localStorage.setItem(k,JSON.stringify(v))}

document.getElementById("base_fecha").value = now();

function openWin(id){
 document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 renderCustomLabels();
}

/* ===== CLONAR VENTANA ===== */
function cloneWindow(){
 const name = new_win_name.value.trim();
 if(!name) return alert("Nombre requerido");

 const id = "win_"+Date.now();

 // BotÃ³n
 const btn = document.createElement("button");
 btn.textContent = "ğŸ§© "+name;
 btn.onclick = ()=>openWin(id);
 document.getElementById("mainNav").insertBefore(btn, document.querySelector(".secondary"));

 // SecciÃ³n
 const base = document.getElementById("base");
 const clone = base.cloneNode(true);
 clone.id = id;
 clone.querySelector("h3").textContent = name;
 clone.querySelectorAll("[id]").forEach(e=>{
  e.id = e.id.replace("base", id);
 });
 document.body.insertBefore(clone, document.getElementById("config"));

 document.getElementById(id+"_fecha").value = now();
 new_win_name.value="";
 alert("Ventana creada");
}

/* ===== ETIQUETAS ===== */
function addLabel(){
 const labels=get("labels");
 const id="lbl_"+Date.now();
 labels[id]={
  name:lbl_name.value,
  type:lbl_type.value,
  values:lbl_values.value.split(",").map(v=>v.trim()).filter(v=>v),
  windows:{base:lbl_base.checked}
 };
 set("labels",labels);
 lbl_name.value=""; lbl_values.value="";
 renderCustomLabels(); renderLabelManager();
}

function renderCustomLabels(){
 const labels=get("labels");
 document.querySelectorAll("[id^='custom_']").forEach(cont=>{
  cont.innerHTML="";
  const win = cont.id.replace("custom_","");
  Object.values(labels).forEach(l=>{
   if(l.windows[win]){
    const d=document.createElement("div");
    d.className="field";
    d.innerHTML="<label>"+l.name+"</label>";
    let el;
    if(l.type==="select"){
     el=document.createElement("select");
     l.values.forEach(v=>el.add(new Option(v,v)));
    }else{
     el=document.createElement("input");
     if(l.type==="number") el.inputMode="numeric";
    }
    d.appendChild(el);
    cont.appendChild(d);
   }
  });
 });
}

/* ===== WHATSAPP ===== */
function previewWhatsApp(win){
 let txt="";
 document.querySelectorAll("#"+win+" input,#"+win+" textarea,#custom_"+win+" input,#custom_"+win+" select")
 .forEach(e=>{if(e.value) txt+=e.previousSibling.textContent+": "+e.value+"\n"});
 preview_text.value=txt;
 previewModal.classList.remove("hidden");
}
function sendWA(){
 window.open("https://wa.me/?text="+encodeURIComponent(preview_text.value));
 closePreview();
}
function closePreview(){previewModal.classList.add("hidden")}

/* ===== LIMPIAR ===== */
function clearForm(win){
 document.querySelectorAll("#"+win+" input:not([readonly]),#"+win+" textarea")
 .forEach(e=>e.value="");
 renderCustomLabels();
}

/* ===== EDITAR / DUPLICAR ETIQUETAS ===== */
function renderLabelManager(){
 const cont=label_manager;
 cont.innerHTML="";
 const labels=get("labels");
 Object.entries(labels).forEach(([id,l])=>{
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
   <input id="n_${id}" value="${l.name}">
   <button onclick="saveLabel('${id}')">ğŸ’¾</button>
   <button onclick="dupLabel('${id}')">ğŸ“‘</button>
   <button onclick="delLabel('${id}')">ğŸ—‘ï¸</button>`;
  cont.appendChild(c);
 });
}
function saveLabel(id){
 const labels=get("labels");
 labels[id].name=document.getElementById("n_"+id).value;
 set("labels",labels);
 renderCustomLabels(); renderLabelManager();
}
function dupLabel(id){
 const labels=get("labels");
 const n="lbl_"+Date.now();
 labels[n]=JSON.parse(JSON.stringify(labels[id]));
 labels[n].name+=" (copia)";
 set("labels",labels);
 renderLabelManager();
}
function delLabel(id){
 const labels=get("labels");
 delete labels[id];
 set("labels",labels);
 renderCustomLabels(); renderLabelManager();
}
</script>

</body>
</html>
